<?xml version="1.0" encoding="UTF-8"?>
<odoo>
  <!-- Module category for Payroll 3C (nested under Human Resources) -->
  <record id="module_category_payroll_3c" model="ir.module.category">
    <field name="name">Payroll 3C</field>
    <field name="parent_id" ref="base.module_category_human_resources"/>
    <field name="sequence">12</field>
  </record>

  <!-- Payroll groups mapped to business roles -->
  <record id="group_payroll_employee" model="res.groups">
    <field name="name">Payroll Employee</field>
    <field name="category_id" ref="module_category_payroll_3c"/>
  </record>

  <record id="group_payroll_officer" model="res.groups">
    <field name="name">Payroll Officer</field>
    <field name="category_id" ref="module_category_payroll_3c"/>
  </record>

  <record id="group_payroll_manager" model="res.groups">
    <field name="name">Payroll Manager</field>
    <field name="implied_ids" eval="[(4, ref('payroll_3c.group_payroll_officer'))]"/>
    <field name="category_id" ref="module_category_payroll_3c"/>
  </record>

  <record id="group_payroll_approver" model="res.groups">
    <field name="name">Payroll Approver</field>
    <field name="category_id" ref="module_category_payroll_3c"/>
  </record>

  <!-- Record Rules: Payslip visibility -->
  <record id="rule_payslip_employee_own" model="ir.rule">
    <field name="name">Payslip: Employee sees own</field>
    <field name="model_id" ref="model_payroll_payslip"/>
    <field name="domain_force">[("employee_user_id", "=", user.id)]</field>
    <field name="groups" eval="[(4, ref('payroll_3c.group_payroll_employee'))]"/>
  </record>

  <record id="rule_payslip_officer_all" model="ir.rule">
    <field name="name">Payslip: Officer sees all</field>
    <field name="model_id" ref="model_payroll_payslip"/>
    <field name="domain_force">[]</field>
    <field name="groups" eval="[(4, ref('payroll_3c.group_payroll_officer'))]"/>
  </record>

  <record id="rule_payslip_manager_all" model="ir.rule">
    <field name="name">Payslip: Manager sees all</field>
    <field name="model_id" ref="model_payroll_payslip"/>
    <field name="domain_force">[]</field>
    <field name="groups" eval="[(4, ref('payroll_3c.group_payroll_manager'))]"/>
  </record>

  <record id="rule_payslip_approver_all" model="ir.rule">
    <field name="name">Payslip: Approver sees all</field>
    <field name="model_id" ref="model_payroll_payslip"/>
    <field name="domain_force">[]</field>
    <field name="groups" eval="[(4, ref('payroll_3c.group_payroll_approver'))]"/>
  </record>

  <!-- Record Rules: KPI records visibility -->
  <record id="rule_kpi_record_employee_own" model="ir.rule">
    <field name="name">KPI: Employee sees own records</field>
    <field name="model_id" ref="model_payroll_kpi_record"/>
    <field name="domain_force">[("employee_user_id", "=", user.id)]</field>
    <field name="groups" eval="[(4, ref('payroll_3c.group_payroll_employee'))]"/>
  </record>

  <record id="rule_kpi_record_officer_all" model="ir.rule">
    <field name="name">KPI: Officer sees all</field>
    <field name="model_id" ref="model_payroll_kpi_record"/>
    <field name="domain_force">[]</field>
    <field name="groups" eval="[(4, ref('payroll_3c.group_payroll_officer'))]"/>
  </record>

  <record id="rule_kpi_record_manager_all" model="ir.rule">
    <field name="name">KPI: Manager sees all</field>
    <field name="model_id" ref="model_payroll_kpi_record"/>
    <field name="domain_force">[]</field>
    <field name="groups" eval="[(4, ref('payroll_3c.group_payroll_manager'))]"/>
  </record>

  <!-- Record Rules: KPI Adjustment Records visibility -->
  <record id="rule_kpi_adjust_record_employee_own" model="ir.rule">
    <field name="name">KPI Adjust: Employee sees own</field>
    <field name="model_id" ref="model_payroll_kpi_adjust_record"/>
    <field name="domain_force">[("employee_user_id", "=", user.id)]</field>
    <field name="perm_read" eval="True"/>
    <field name="perm_write" eval="False"/>
    <field name="perm_create" eval="False"/>
    <field name="perm_unlink" eval="False"/>
    <field name="groups" eval="[(4, ref('payroll_3c.group_payroll_employee'))]"/>
  </record>

  <record id="rule_kpi_adjust_record_employee_manual_write" model="ir.rule">
    <field name="name">KPI Adjust: Employee edit own manual only</field>
    <field name="model_id" ref="model_payroll_kpi_adjust_record"/>
    <field name="domain_force">[("employee_user_id", "=", user.id), ("source_type", "=", "manual")]</field>
    <field name="perm_read" eval="False"/>
    <field name="perm_write" eval="True"/>
    <field name="perm_create" eval="True"/>
    <field name="perm_unlink" eval="True"/>
    <field name="groups" eval="[(4, ref('payroll_3c.group_payroll_employee'))]"/>
  </record>
  <record id="rule_kpi_adjust_record_officer_all" model="ir.rule">
    <field name="name">KPI Adjust: Officer sees all</field>
    <field name="model_id" ref="model_payroll_kpi_adjust_record"/>
    <field name="domain_force">[]</field>
    <field name="groups" eval="[(4, ref('payroll_3c.group_payroll_officer'))]"/>
  </record>
  <record id="rule_kpi_adjust_record_manager_all" model="ir.rule">
    <field name="name">KPI Adjust: Manager sees all</field>
    <field name="model_id" ref="model_payroll_kpi_adjust_record"/>
    <field name="domain_force">[]</field>
    <field name="groups" eval="[(4, ref('payroll_3c.group_payroll_manager'))]"/>
  </record>
</odoo>
